<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Автомобили — Web UI</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

            .search-box input {
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                flex-grow: 1;
                min-width: 200px;
            }

            .search-box button {
                padding: 8px 16px;
                background: #3498db;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                transition: background 0.2s;
            }

                .search-box button:hover {
                    background: #2980b9;
                }

        .cars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .car-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s;
        }

            .car-card:hover {
                transform: translateY(-5px);
            }

        .car-image {
            width: 100%;
            height: 180px;
            background: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: #777;
        }

        .car-info, .edit-form {
            padding: 15px;
        }

        .car-title {
            font-size: 1.2em;
            font-weight: bold;
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .car-spec, .car-price, .car-dealer {
            margin: 5px 0;
            font-size: 0.9em;
            color: #555;
        }

        .car-price {
            font-weight: bold;
            color: #e74c3c;
        }

        .car-controls {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s;
        }

        .btn-edit {
            background: #f39c12;
            color: white;
        }

            .btn-edit:hover {
                background: #e67e22;
            }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

            .btn-delete:hover {
                background: #c0392b;
            }

        .btn-save {
            background: #2ecc71;
            color: white;
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
        }

        .edit-form input, .edit-form select {
            width: 100%;
            padding: 6px;
            margin: 4px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .edit-form label {
            font-weight: bold;
            font-size: 0.85em;
            color: #34495e;
        }

        @media (max-width: 768px) {
            .cars-grid {
                grid-template-columns: 1fr;
            }

            .search-box {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Список автомобилей</h1>

        <div class="search-box">
            <input type="number" id="carIdInput" placeholder="Введите ID автомобиля" />
            <button onclick="getCarById()">Найти по ID</button>
            <button onclick="loadAllCars()">Показать все</button>
        </div>

        <div class="cars-grid" id="carsContainer"></div>
    </div>

    <script>
        const API_BASE = 'https://localhost:7100/api/cars';

        window.onload = loadAllCars;

        async function loadAllCars() {
            try {
                const response = await fetch(API_BASE);
                const data = await response.json();
                renderCars(data.$values || data);
            } catch (err) {
                alert('Ошибка загрузки: ' + err.message);
            }
        }

        async function getCarById() {
            const id = document.getElementById('carIdInput').value;
            if (!id) return alert('Введите ID');
            try {
                const response = await fetch(`${API_BASE}/${id}`);
                if (!response.ok) throw new Error('Автомобиль не найден');
                const car = await response.json();
                renderCars([car]);
            } catch (err) {
                alert(err.message);
            }
        }

        function renderCars(cars) {
            const container = document.getElementById('carsContainer');
            container.innerHTML = '';

            cars.forEach(car => {
                const div = document.createElement('div');
                div.className = 'car-card';

                div.innerHTML = `
                        <div class="car-image">
                            <img src="https://placehold.co/600x400?text=${encodeURIComponent(car.model || 'Auto')}&font=roboto"
                                 style="width:100%;height:100%;object-fit:cover;" alt="${car.model}" />
                        </div>
                        <div class="car-info" id="info-${car.id}">
                            <h2 class="car-title">${car.firm || ''} ${car.model || ''} (${car.year || ''})</h2>
                            <p class="car-spec"><strong>Мощность:</strong> ${car.power || ''} л.с.</p>
                            <p class="car-spec"><strong>Цвет:</strong> ${car.color || ''}</p>
                            <p class="car-price">Цена: ${car.price || ''} ₽</p>
                            <p class="car-dealer">Дилер ID: ${car.dealerID || ''}</p>
                            <div class="car-controls">
                                <button class="btn btn-edit" onclick="showEditForm(${car.id})">Редактировать</button>
                                <button class="btn btn-delete" onclick="deleteCar(${car.id})">Удалить</button>
                            </div>
                        </div>
                        <div class="edit-form" id="form-${car.id}" style="display:none;">
                            <label>ID</label>
                            <input type="number" id="edit-id-${car.id}" value="${car.id}" readonly />

                            <label>Фирма</label>
                            <input type="text" id="edit-firm-${car.id}" value="${car.firm || ''}" />

                            <label>Модель</label>
                            <input type="text" id="edit-model-${car.id}" value="${car.model || ''}" />

                            <label>Год</label>
                            <input type="number" id="edit-year-${car.id}" value="${car.year || ''}" />

                            <label>Мощность (л.с.)</label>
                            <input type="number" id="edit-power-${car.id}" value="${car.power || ''}" />

                            <label>Цвет</label>
                            <input type="text" id="edit-color-${car.id}" value="${car.color || ''}" />

                            <label>Цена (₽)</label>
                            <input type="number" step="0.01" id="edit-price-${car.id}" value="${car.price || ''}" />

                            <label>Dealer ID</label>
                            <input type="number" id="edit-dealerID-${car.id}" value="${car.dealerID || ''}" />

                            <div class="car-controls" style="margin-top:10px;">
                                <button class="btn btn-save" onclick="saveCar(${car.id})">Сохранить</button>
                                <button class="btn btn-cancel" onclick="hideEditForm(${car.id})">Отмена</button>
                            </div>
                        </div>
                    `;
                container.appendChild(div);
            });
        }

        function showEditForm(id) {
            document.getElementById(`info-${id}`).style.display = 'none';
            document.getElementById(`form-${id}`).style.display = 'block';
        }

        function hideEditForm(id) {
            document.getElementById(`info-${id}`).style.display = 'block';
            document.getElementById(`form-${id}`).style.display = 'none';
        }

        async function saveCar(id) {
            const updated = {
                id: parseInt(document.getElementById(`edit-id-${id}`).value),
                firm: document.getElementById(`edit-firm-${id}`).value,
                model: document.getElementById(`edit-model-${id}`).value,
                year: parseInt(document.getElementById(`edit-year-${id}`).value) || 0,
                power: parseInt(document.getElementById(`edit-power-${id}`).value) || 0,
                color: document.getElementById(`edit-color-${id}`).value,
                price: parseFloat(document.getElementById(`edit-price-${id}`).value) || 0,
                dealerID: parseInt(document.getElementById(`edit-dealerID-${id}`).value) || 0
            };

            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updated)
                });

                if (response.ok) {
                    alert('Автомобиль успешно обновлён!');
                    loadAllCars();
                } else {
                    throw new Error('Ошибка обновления: ' + response.status);
                }
            } catch (err) {
                alert('Ошибка: ' + err.message);
            }
        }

        async function deleteCar(id) {
            if (!confirm('Удалить автомобиль?')) return;
            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('Автомобиль удалён');
                    loadAllCars();
                } else {
                    throw new Error('Ошибка удаления');
                }
            } catch (err) {
                alert('Ошибка: ' + err.message);
            }
        }
    </script>
</body>
</html>